#include <iostream>
#include <string.h>
using namespace std;
const char *arq = "cinemas.dat";

struct Cinema{
	int id;
    char nome[15];
    char shopping[30];
    char sala[5];
};

void menu();
void post();
void readAll();
void update();
void deleteOne();

main(){
	
menu();

}

void menu ()
{
	int opcao;

	do
    {
        system("clear||cls");
        std::cout << "=-=-=- C.R.U.D DE CINEMAS =-=-=-\n\n";
        std::cout << "[1] - Exibir uma cidade\n";
        std::cout << "[2] - Exibir vÃ¡rias cidades\n";
        std::cout << "[3] - Adicionar uma cidade\n";
        std::cout << "[4] - Excluir uma cidade\n";
        std::cout << "[5] - Editar uma cidade\n";
        std::cout << "[0] - Sair do programa\n\n";

        cout<<"Digite uma opcao... "; 
        cin>>opcao;

        switch(opcao){
            case 1:
            break;
            case 2:
            break;
            case 3:
            break;
            case 4:
            break;
            case 5:
            break;
            // case 1:
            // 		crear ();
            // 		cout<<"\n";
            // 	system("pause");
            // break;
            // case 2 :
            // 	cout<<"------ L I S T A ------"<<endl;
            // 	leer ();
            // 	cout<<"\n";
            // 	system("pause");	
            // break;
            // case 3:
            // 	actualizar ();
            // 	system("pause");
            // break;
            // case 4: 
            // 	deleter();
            // 	system("pause");
            // break; 
            }
            system ("cls");
	}
    while (opcao != 5);
}


void update(){
	FILE* arquivo = fopen(arq,"r+b");
	int id;
	Cinema cinema;
	string nome, sala, shopping;

	cout<<"Digite o [ID] do cinema que queira editar:";
	cin>>id;

	fseek(arquivo, id * sizeof(Cinema), SEEK_SET);
	cout<<"Digite o [ID] do cinema:";
		cin>>cinema.id;
		cin.ignore();
		cout<<"Digite o [NOME] do cinema:";
		getline(cin, nome);
		strcpy(cinema.nome, nome.c_str());
		cout<<"Digite o [NOME] do [SHOPPING]:";
		getline(cin, shopping);
		strcpy(cinema.shopping, shopping.c_str());
		cout<<"Digite a [SALA] do cinema:";
		getline(cin, sala);
		strcpy(cinema.sala, sala.c_str());
		cin.ignore();
	
	fwrite(&cinema, sizeof(Cinema), 1, arquivo);
	fclose(arquivo);
	readAll();
}
void post()
{
	char continuar;
	FILE* arquivo = fopen(arq,"ab");
	Cinema cinema;
	string nome, sala, shopping;
	do{
		fflush(stdin);
		cout<<"Digite o [ID]:";
		cin>>cinema.id;
		cin.ignore();
		cout<<"Digite o [NOME] do [CINEMA]:";
		getline(cin, nome);
		strcpy(cinema.nome, nome.c_str());
		cout<<"Digite o [NOME] do [SHOPPING]:";
		getline(cin, shopping);
		strcpy(cinema.shopping, shopping.c_str());
		cout<<"Digite a [SALA]:";
		getline(cin, sala);
		strcpy(cinema.sala, sala.c_str());
		cin.ignore();

		fwrite(&cinema, sizeof(Cinema), 1, arquivo);

		cout<<"Deseja continuar adicionando? (S/N): ";
		cin>>continuar;
	} 
    while (toupper(continuar) == 'S');
	fclose(arquivo);

}
void readAll(){
		system("cls");
        
		FILE* arquivo = fopen(arq,"rb");	
        
		if (!arquivo)
        {
			arquivo = fopen(arq,"w+b");	
		}

		Cinema cinema;
		int id=0;	

		fread(&cinema, sizeof(Cinema), 1, arquivo);
        
		do
        {
			cout<<"________________"<<endl;
			cout<<id<<"|"<<cinema.id<<"|"<<cinema.nome<<"|"<<cinema.shopping<<"|"<<cinema.sala<<endl;	
			
		    fread(&cinema,sizeof(Cinema),1,arquivo);
		    id += 1;	
		}
        while(feof(arquivo) == 0);
		fclose(arquivo);
		cout<<endl;
}

void deleteOne()
{
	FILE* arquivo = fopen(arq,"r+b");
	if (!arquivo){
		arquivo = fopen(arq,"tempt");	
	}
	int id;
	Cinema cinema;
	string nome, shopping, sala;

	cout<<"Digite o [ID] do cinema que voce quer excluir:";
	cin>>id;
	fseek(arquivo, id * sizeof(Cinema), SEEK_SET);
	cout<<"[DELETADO]"<<endl;

	fwrite(&cinema, sizeof(Cinema), 1, arquivo);
	fclose(arquivo);

	remove("r+b");
	rename("tempt", "r+b");
	readAll();
}